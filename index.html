<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enduro ‚Äî Professional Testing Platform</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Professional Navigation */
        .main-nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #E5E7EB;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 80px;
        }
        
        .nav-logo {
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            color: #0F172A;
            text-transform: uppercase;
        }
        
        .nav-actions {
            display: flex;
            gap: 1rem;
        }
        
        /* Hero Section - Ultra Professional */
        .hero-section {
            min-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8rem 2rem 6rem;
            background: #FFFFFF;
            margin-top: 80px;
        }
        
        .hero-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .hero-content {
            text-align: left;
            max-width: 720px;
        }
        
        .hero-label {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #64748B;
            margin-bottom: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #0F172A;
        }
        
        .hero-title {
            font-size: 4rem;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.03em;
            color: #0F172A;
            margin-bottom: 2rem;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            line-height: 1.7;
            color: #475569;
            margin-bottom: 3rem;
            font-weight: 400;
        }
        
        .hero-actions {
            display: flex;
            gap: 1.25rem;
        }
        
        .btn-large {
            padding: 1rem 2rem;
            font-size: 0.9375rem;
            font-weight: 500;
            border-radius: 0;
            letter-spacing: 0.02em;
            transition: all 0.2s ease;
        }
        
        .btn-primary-pro {
            background: #0F172A;
            color: #FFFFFF;
            border: 2px solid #0F172A;
        }
        
        .btn-primary-pro:hover {
            background: #1E293B;
            border-color: #1E293B;
        }
        
        .btn-secondary-pro {
            background: transparent;
            color: #0F172A;
            border: 2px solid #0F172A;
        }
        
        .btn-secondary-pro:hover {
            background: #0F172A;
            color: #FFFFFF;
        }
        
        /* Stats Section */
        .stats-section {
            background: #F8FAFC;
            padding: 5rem 2rem;
            border-top: 1px solid #E5E7EB;
            border-bottom: 1px solid #E5E7EB;
        }
        
        .stats-container {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: #0F172A;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #64748B;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Features Section - Minimalist Grid */
        .features-section {
            padding: 6rem 2rem;
            background: #FFFFFF;
        }
        
        .features-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .section-header {
            max-width: 720px;
            margin-bottom: 5rem;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0F172A;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }
        
        .section-description {
            font-size: 1.125rem;
            color: #475569;
            line-height: 1.7;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3rem;
        }
        
        .feature-item {
            padding: 0;
        }
        
        .feature-number {
            font-size: 0.75rem;
            font-weight: 600;
            color: #94A3B8;
            letter-spacing: 0.1em;
            margin-bottom: 1.5rem;
        }
        
        .feature-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #0F172A;
            margin-bottom: 1rem;
            letter-spacing: -0.01em;
        }
        
        .feature-description {
            font-size: 0.9375rem;
            color: #64748B;
            line-height: 1.7;
        }
        
        /* CTA Section - Sophisticated */
        .cta-section {
            background: #0F172A;
            padding: 6rem 2rem;
            text-align: center;
        }
        
        .cta-container {
            max-width: 720px;
            margin: 0 auto;
        }
        
        .cta-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }
        
        .cta-description {
            font-size: 1.125rem;
            color: #94A3B8;
            margin-bottom: 3rem;
            line-height: 1.7;
        }
        
        .cta-button {
            background: #FFFFFF;
            color: #0F172A;
            border: 2px solid #FFFFFF;
            padding: 1rem 2.5rem;
            font-size: 0.9375rem;
            font-weight: 500;
            border-radius: 0;
            letter-spacing: 0.02em;
            transition: all 0.2s ease;
            display: inline-block;
        }
        
        .cta-button:hover {
            background: transparent;
            color: #FFFFFF;
        }
        
        /* Footer - Minimal */
        .main-footer {
            background: #0F172A;
            padding: 2rem;
            text-align: center;
            border-top: 1px solid #1E293B;
        }
        
        .footer-text {
            font-size: 0.875rem;
            color: #64748B;
            letter-spacing: 0.02em;
        }
        
        .footer-link {
            color: #94A3B8;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .footer-link:hover {
            color: #FFFFFF;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
                gap: 3rem;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
                gap: 3rem;
            }
            
            .nav-actions {
                gap: 0.5rem;
            }
            
            .btn-large {
                padding: 0.875rem 1.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-logo">Enduro</div>
            <div class="nav-actions">
                <a href="login.html" class="btn btn-primary-pro">Sign In</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-container">
            <div class="hero-content">
                <span class="hero-label">Welcome to Enduro</span>
                <h1 class="hero-title">Enduro 2025-26 Python Challenge Test</h1>
                <p class="hero-subtitle">Test your Python programming skills with our comprehensive challenge. Complete 12 carefully crafted questions in 1 hour and showcase your technical proficiency through real-time code execution.</p>
                <div class="hero-actions">
                    <a href="login.html" class="btn btn-large btn-primary-pro">Begin Test</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-number">99.9%</div>
                <div class="stat-label">Uptime Reliability</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">< 100ms</div>
                <div class="stat-label">Code Execution</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">24/7</div>
                <div class="stat-label">Platform Access</div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
        <div class="features-container">
            <div class="section-header">
                <h2 class="section-title">Enterprise-grade testing capabilities</h2>
                <p class="section-description">A comprehensive platform built for technical evaluation with institutional-level security and precision.</p>
            </div>
            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-number">01</div>
                    <h3 class="feature-title">Timed Tests</h3>
                    <p class="feature-description">Structured evaluation windows with precise time management, designed to measure performance under standardized conditions.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-number">02</div>
                    <h3 class="feature-title">Real-Time Execution</h3>
                    <p class="feature-description">Immediate code validation against comprehensive test suites with instant feedback mechanisms and error reporting.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-number">03</div>
                    <h3 class="feature-title">Advanced Analytics</h3>
                    <p class="feature-description">Granular performance metrics with historical tracking, question-level analysis, and detailed competency mapping.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="cta-container">
            <h2 class="cta-title">Ready to evaluate technical proficiency?</h2>
            <p class="cta-description">Access the platform to begin standardized Python assessment procedures.</p>
            <a href="login.html" class="cta-button">Access Platform</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="main-footer">
        <p class="footer-text">¬© 2026 Enduro. All rights reserved. | <a href="admin-dashboard.html" class="footer-link">Admin Portal</a></p>
    </footer>

    <!-- Secret Data Access Buttons -->
    <div style="position: fixed; bottom: 5px; right: 5px; z-index: 9999; display: flex; gap: 6px;">
        <button id="secretDataBtn" style="width: 8px; height: 8px; background: #e5e7eb; border: none; border-radius: 50%; opacity: 0.3; cursor: pointer; padding: 0; transition: all 0.3s;" title="Data Access"></button>
        <button id="rankingBtn" style="width: 8px; height: 8px; background: #e5e7eb; border: none; border-radius: 50%; opacity: 0.3; cursor: pointer; padding: 0; transition: all 0.3s;" title="Rankings"></button>
    </div>

    <!-- Data Viewer Modal -->
    <div id="dataModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow: auto;">
        <div style="background: white; margin: 2rem auto; max-width: 1200px; border-radius: 8px; padding: 2rem; position: relative;">
            <button id="closeModal" style="position: absolute; top: 1rem; right: 1rem; background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 600;">Close</button>
            <h2 style="color: #0F172A; margin-bottom: 1rem;">Student Test Data</h2>
            <div style="margin-bottom: 1rem;">
                <button id="exportDataBtn" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; font-weight: 600; margin-right: 0.5rem;">Export All Data (JSON)</button>
                <button id="exportCSVBtn" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; font-weight: 600;">Export Summary (CSV)</button>
            </div>
            <div id="dataContent" style="max-height: 70vh; overflow: auto; border: 1px solid #e5e7eb; border-radius: 4px; padding: 1rem;">
                <p style="color: #64748B;">Loading data...</p>
            </div>
        </div>
    </div>

    <!-- Ranking Modal -->
    <div id="rankingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow: auto;">
        <div style="background: white; margin: 2rem auto; max-width: 1000px; border-radius: 8px; padding: 2rem; position: relative;">
            <button id="closeRankingModal" style="position: absolute; top: 1rem; right: 1rem; background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 600;">Close</button>
            <h2 style="color: #0F172A; margin-bottom: 0.5rem;">üèÜ Student Rankings</h2>
            <p style="color: #64748B; margin-bottom: 1.5rem; font-size: 0.9rem;">Ranked by highest test scores</p>
            <div style="margin-bottom: 1rem;">
                <button id="exportRankingCSVBtn" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; font-weight: 600;">Export Rankings (CSV)</button>
            </div>
            <div id="rankingContent" style="max-height: 70vh; overflow: auto; border: 1px solid #e5e7eb; border-radius: 4px; padding: 1rem;">
                <p style="color: #64748B;">Loading rankings...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { getAllUsers, getAllTests, getAllTestAttempts } from './js/firebase-database.js';

        const secretBtn = document.getElementById('secretDataBtn');
        const rankingBtn = document.getElementById('rankingBtn');
        const dataModal = document.getElementById('dataModal');
        const rankingModal = document.getElementById('rankingModal');
        const closeModal = document.getElementById('closeModal');
        const closeRankingModal = document.getElementById('closeRankingModal');
        const dataContent = document.getElementById('dataContent');
        const rankingContent = document.getElementById('rankingContent');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const exportCSVBtn = document.getElementById('exportCSVBtn');
        const exportRankingCSVBtn = document.getElementById('exportRankingCSVBtn');

        let allData = null;

        // Hover effect for secret button
        secretBtn.addEventListener('mouseenter', () => {
            secretBtn.style.opacity = '1';
            secretBtn.style.width = '12px';
            secretBtn.style.height = '12px';
            secretBtn.style.background = '#3b82f6';
        });

        secretBtn.addEventListener('mouseleave', () => {
            secretBtn.style.opacity = '0.3';
            secretBtn.style.width = '8px';
            secretBtn.style.height = '8px';
            secretBtn.style.background = '#e5e7eb';
        });

        // Hover effect for ranking button
        rankingBtn.addEventListener('mouseenter', () => {
            rankingBtn.style.opacity = '1';
            rankingBtn.style.width = '12px';
            rankingBtn.style.height = '12px';
            rankingBtn.style.background = '#8b5cf6';
        });

        rankingBtn.addEventListener('mouseleave', () => {
            rankingBtn.style.opacity = '0.3';
            rankingBtn.style.width = '8px';
            rankingBtn.style.height = '8px';
            rankingBtn.style.background = '#e5e7eb';
        });

        // Show data modal
        secretBtn.addEventListener('click', async () => {
            dataModal.style.display = 'block';
            await loadAllData();
        });

        // Show ranking modal
        rankingBtn.addEventListener('click', async () => {
            rankingModal.style.display = 'block';
            await loadRankingData();
        });

        closeModal.addEventListener('click', () => {
            dataModal.style.display = 'none';
        });

        closeRankingModal.addEventListener('click', () => {
            rankingModal.style.display = 'none';
        });

        // Close on outside click
        dataModal.addEventListener('click', (e) => {
            if (e.target === dataModal) {
                dataModal.style.display = 'none';
            }
        });

        rankingModal.addEventListener('click', (e) => {
            if (e.target === rankingModal) {
                rankingModal.style.display = 'none';
            }
        });

        async function loadAllData() {
            try {
                console.log('Loading data from Firebase...');
                // Use the firebase-database functions
                const users = await getAllUsers();
                const attempts = await getAllTestAttempts();
                const tests = await getAllTests();

                console.log('Users loaded:', users.length);
                console.log('Attempts loaded:', attempts.length);
                console.log('Tests loaded:', tests.length);

                const students = users.filter(u => u.role === 'student');
                
                allData = { students, attempts, tests };

                displayData(students, attempts);
            } catch (error) {
                console.error('Error loading data:', error);
                // Fallback to localStorage
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const students = users.filter(u => u.role === 'student');
                const attempts = JSON.parse(localStorage.getItem('testAttempts') || '[]');
                const tests = JSON.parse(localStorage.getItem('tests') || '[]');

                console.log('Fallback - Students:', students.length, 'Attempts:', attempts.length);

                allData = { students, attempts, tests };
                displayData(students, attempts);
            }
        }

        async function loadRankingData() {
            try {
                console.log('Loading ranking data from Firebase...');
                // Use the firebase-database functions
                const users = await getAllUsers();
                const attempts = await getAllTestAttempts();

                console.log('Ranking - Users loaded:', users.length);
                console.log('Ranking - Attempts loaded:', attempts.length);

                const students = users.filter(u => u.role === 'student');

                displayRankings(students, attempts);
            } catch (error) {
                console.error('Error loading ranking data:', error);
                // Fallback to localStorage
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const students = users.filter(u => u.role === 'student');
                const attempts = JSON.parse(localStorage.getItem('testAttempts') || '[]');

                console.log('Ranking Fallback - Students:', students.length, 'Attempts:', attempts.length);

                displayRankings(students, attempts);
            }
        }

        function displayData(students, attempts) {
            if (students.length === 0) {
                dataContent.innerHTML = '<p style="color: #64748B;">No student data available.</p>';
                return;
            }

            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr style="background: #f8fafc; border-bottom: 2px solid #e5e7eb;">';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">Name</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">Email</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">Department</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">WhatsApp</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">Tests</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">Best Score</th>';
            html += '</tr></thead><tbody>';

            students.forEach(student => {
                const studentAttempts = attempts.filter(a => a.userEmail === student.email);
                const bestScore = studentAttempts.length > 0 
                    ? Math.max(...studentAttempts.map(a => a.score || 0))
                    : 0;

                html += '<tr style="border-bottom: 1px solid #e5e7eb;">';
                html += `<td style="padding: 0.75rem;">${student.name}</td>`;
                html += `<td style="padding: 0.75rem;">${student.email}</td>`;
                html += `<td style="padding: 0.75rem;">${student.department || 'N/A'}</td>`;
                html += `<td style="padding: 0.75rem;">${student.whatsapp || 'N/A'}</td>`;
                html += `<td style="padding: 0.75rem;">${studentAttempts.length}</td>`;
                html += `<td style="padding: 0.75rem; font-weight: 600; color: #10b981;">${bestScore}%</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            dataContent.innerHTML = html;
        }

        function displayRankings(students, attempts) {
            if (students.length === 0) {
                rankingContent.innerHTML = '<p style="color: #64748B;">No student data available.</p>';
                return;
            }

            // Calculate rankings
            const rankings = students.map(student => {
                const studentAttempts = attempts.filter(a => a.userEmail === student.email);
                const bestScore = studentAttempts.length > 0 
                    ? Math.max(...studentAttempts.map(a => a.score || 0))
                    : 0;
                const totalMarks = studentAttempts.reduce((sum, a) => sum + (a.score || 0), 0);
                const avgScore = studentAttempts.length > 0 
                    ? (totalMarks / studentAttempts.length).toFixed(2)
                    : 0;

                return {
                    name: student.name,
                    email: student.email,
                    whatsapp: student.whatsapp || 'N/A',
                    bestScore: bestScore,
                    totalMarks: totalMarks,
                    avgScore: avgScore,
                    testsCount: studentAttempts.length
                };
            });

            // Sort by best score (descending), then by total marks
            rankings.sort((a, b) => {
                if (b.bestScore !== a.bestScore) {
                    return b.bestScore - a.bestScore;
                }
                return b.totalMarks - a.totalMarks;
            });

            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr style="background: #f8fafc; border-bottom: 2px solid #e5e7eb;">';
            html += '<th style="padding: 0.75rem; text-align: center; font-weight: 600; color: #0F172A; width: 60px;">Rank</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">Name</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">Email</th>';
            html += '<th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #0F172A;">WhatsApp</th>';
            html += '<th style="padding: 0.75rem; text-align: center; font-weight: 600; color: #0F172A;">Best Score</th>';
            html += '<th style="padding: 0.75rem; text-align: center; font-weight: 600; color: #0F172A;">Total Marks</th>';
            html += '<th style="padding: 0.75rem; text-align: center; font-weight: 600; color: #0F172A;">Avg Score</th>';
            html += '</tr></thead><tbody>';

            rankings.forEach((student, index) => {
                let rankIcon = '';
                let rankStyle = '';
                
                if (index === 0) {
                    rankIcon = 'ü•á';
                    rankStyle = 'background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);';
                } else if (index === 1) {
                    rankIcon = 'ü•à';
                    rankStyle = 'background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);';
                } else if (index === 2) {
                    rankIcon = 'ü•â';
                    rankStyle = 'background: linear-gradient(135deg, #cd7f32 0%, #e8a87c 100%);';
                }

                html += `<tr style="border-bottom: 1px solid #e5e7eb; ${rankStyle}">`;
                html += `<td style="padding: 0.75rem; text-align: center; font-weight: 700; font-size: 1.1rem;">${rankIcon || (index + 1)}</td>`;
                html += `<td style="padding: 0.75rem; font-weight: 600;">${student.name}</td>`;
                html += `<td style="padding: 0.75rem;">${student.email}</td>`;
                html += `<td style="padding: 0.75rem;">${student.whatsapp}</td>`;
                html += `<td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #10b981; font-size: 1.1rem;">${student.bestScore}%</td>`;
                html += `<td style="padding: 0.75rem; text-align: center; font-weight: 600; color: #3b82f6;">${student.totalMarks}%</td>`;
                html += `<td style="padding: 0.75rem; text-align: center;">${student.avgScore}%</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            rankingContent.innerHTML = html;

            // Store for export
            window.currentRankings = rankings;
        }

        // Export as JSON
        exportDataBtn.addEventListener('click', () => {
            if (!allData) return;

            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `student-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });

        // Export as CSV
        exportCSVBtn.addEventListener('click', () => {
            if (!allData) return;

            let csv = 'Name,Email,Department,WhatsApp,Registered Date,Total Tests,Best Score,Average Score\n';

            allData.students.forEach(student => {
                const studentAttempts = allData.attempts.filter(a => a.userEmail === student.email);
                const bestScore = studentAttempts.length > 0 
                    ? Math.max(...studentAttempts.map(a => a.score || 0))
                    : 0;
                const avgScore = studentAttempts.length > 0
                    ? (studentAttempts.reduce((sum, a) => sum + (a.score || 0), 0) / studentAttempts.length).toFixed(2)
                    : 0;

                csv += `"${student.name}","${student.email}","${student.department || 'N/A'}","${student.whatsapp || 'N/A'}","${new Date(student.createdAt).toLocaleDateString()}",${studentAttempts.length},${bestScore}%,${avgScore}%\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `student-summary-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        });

        // Export Rankings as CSV
        exportRankingCSVBtn.addEventListener('click', () => {
            if (!window.currentRankings) return;

            let csv = 'Rank,Name,Email,WhatsApp,Best Score,Total Marks,Average Score,Tests Taken\n';

            window.currentRankings.forEach((student, index) => {
                csv += `${index + 1},"${student.name}","${student.email}","${student.whatsapp}",${student.bestScore}%,${student.totalMarks}%,${student.avgScore}%,${student.testsCount}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `student-rankings-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>
